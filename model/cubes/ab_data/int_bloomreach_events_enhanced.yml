cubes:
  - name: int_bloomreach_events_enhanced
    sql: dev_gsokolov.int_bloomreach_events_enhanced

    measures:
      - name: event_cnt
        type: count
      - name: msg_cnt
        type: count
        sql: "message_id"
      - name: distinct_users
        sql: "{CUBE}.user_id"
        type: count_distinct

      - name: hour_cnt
        sql: "EXTRACT(HOUR FROM timestamp)"
        type: count

    dimensions:
      - name: user_id
        sql: user_id
        primary_key: true
        type: number
      - name: event_hour
        sql: "EXTRACT(HOUR FROM timestamp)"
        type: string
      - name: google_push_notification_id
        sql: "google_push_notification_id"
        type: string
      - name: has_token
        sql: "{CUBE}.google_push_notification_id is not NULL and {CUBE}.google_push_notification_id <> ''"
        type: boolean
      - name: campaign_id
        sql: "campaign_id"
        type: string
      - name: timestamp
        sql: timestamp
        type: time

    segments:
      - name: pushes
        sql: "{CUBE}.action_type = 'mobile notification'"
      - name: failed_pushes
        sql: "{CUBE}.action_type = 'mobile notification' AND {CUBE}.status = 'failed'"
